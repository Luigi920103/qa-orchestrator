name: QA Orchestrator Central

on:
  repository_dispatch:
    types: [trigger-automation]
  workflow_dispatch:
    inputs:
      service:
        description: 'Framework'
        required: true
        default: 'pw_ts_bdd'
        type: choice
        options: [pw_ts_bdd, pw_ts, pw_js_bdd, pw_js, all]
      env:
        description: 'Ambiente'
        required: true
        default: 'dev'
        type: choice
        options: [dev, staging, qa, prod]

jobs:
  routing:
    name: Route Execution
    runs-on: ubuntu-latest
    steps:
      - name: üîç Analyzing Trigger
        run: |
          echo "Source: ${{ github.event_name }}"
          echo "Payload: ${{ toJson(github.event.client_payload) }}"

      - name: üöÄ Triggering Playwright TS BDD
        if: |
          (github.event_name == 'workflow_dispatch' && (inputs.service == 'pw_ts_bdd' || inputs.service == 'all')) ||
          (github.event_name == 'repository_dispatch' && github.event.client_payload.pw_ts_bdd_changed == 'true')
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.ORCHESTRATOR_TOKEN }}
          repository: Luigi920103/pw_ts_bdd
          event-type: run-playwright-docker
          client_payload: '{"env": "${{ github.event.client_payload.env || inputs.env || "dev" }}"}'

      - name: üöÄ Triggering Playwright TS
        if: |
          (github.event_name == 'workflow_dispatch' && (inputs.service == 'pw_ts' || inputs.service == 'all')) ||
          (github.event_name == 'repository_dispatch' && github.event.client_payload.pw_ts_changed == 'true')
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.ORCHESTRATOR_TOKEN }}
          repository: Luigi920103/pw_ts
          event-type: run-playwright-docker
          client_payload: '{"env": "${{ github.event.client_payload.env || inputs.env || "dev" }}"}'
